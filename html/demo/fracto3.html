<HTML>
	<HEAD>
		<TITLE>fracto3</TITLE>
		
		<!--_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-->

		<!--
			trying to get familiar with the webgl stuff.
			want to make as simple an example as possible
		-->

		<!-- this is a crazy bit of helper code -->	
		<script src="js/gl_hooks.js"></script>
		
		<!-- https://github.com/toji/gl-matrix -->
		<script src="js/gl-matrix-min.js"></script> 

		<!--_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-->
		<!-- vertex shader -->

        <script id="shader-vs" type="x-shader/x-vertex">
			precision mediump float;

            attribute vec3 aVertexPosition;
            attribute vec4 aVertexColor;

            uniform mat4 uRotationMatrix;

            varying vec4 vColor; // copy to the fragment shader

            void main() {
				gl_Position = uRotationMatrix * vec4( aVertexPosition, 1.0);
				vColor = aVertexColor; 
            }
		</script>

		<!--_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-->
		<!-- fragment shader -->

        <script id="shader-fs" type="x-shader/x-fragment">
			precision mediump float;

			varying vec4 vColor; // copied from the vertex shader
            void main(void) {
                gl_FragColor = vColor;
            }
		</script>

		<!--_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-->
		<!-- the driver code -->

		<script type="text/javascript">
			window.onload = function() {
				var gl = gl_hookz();
				var util = gl.hookz.util;

				/* alternative to string literals.. */
				var names = gl.hookz.names; 

				var wrap = function( v ) {
					if ( v < 0 ) v = -v;
					if ( v > 1 ) v -= Math.floor( v );
					return v;
				};

				var fracto = function() {
					var vertices = [];
					var colors = [];

					var n = Math.floor( 13 + Math.random() * 33 );

					var x = 0.5 * Math.random();
					var y = 0.5 * Math.random();
					var z = 0.5 * Math.random();

					var r = Math.random();
					var g = Math.random();
					var b = Math.random();

					var angle     = Math.random() * Math.PI * 2 * 4;
					var angle_inc = Math.random() * Math.PI * 2 * 4;
					var distance  = 0.2 * Math.random();

distance = 0.5;
x = y = z = 0;
					
					for ( var i = 0 ; i < n ; i++ ) {
						console.log(z);
						vertices.push( x ); vertices.push( y ); vertices.push( z );

						colors.push( wrap( r ) ); colors.push( wrap( g ) ); colors.push( wrap( b ) ); colors.push( 1 );
						x += Math.cos( angle ) * distance;
						y += Math.sin( angle ) * distance;
						
						z += Math.cos( angle ) * distance;
						r += Math.sin( angle ) * distance;

						g += Math.cos( angle ) * distance;
						b += Math.sin( angle ) * distance;
						
						angle += angle_inc;
					}

					util.setXYZ( names.aVertexPosition, vertices );
					util.setRGBA( names.aVertexColor, colors );

					console.log( n + ' and ' + vertices.length / 3 );

					return n;
				};

				var n = fracto();
				var angle = 0;

				document.getElementsByTagName( 'canvas' )[ 0 ].onclick = function() { n = fracto() };

				var draw = function() {
					util.identity( names.uRotationMatrix );
					util.scale( names.uRotationMatrix, 0.5 );
					util.rotateX( names.uRotationMatrix, angle );
					util.rotateY( names.uRotationMatrix, angle );
					util.rotateZ( names.uRotationMatrix, angle );
					util.updateMatrix( names.uRotationMatrix );	
						
					//gl.drawArrays( gl.LINE_LOOP, 0,  3 );
					gl.drawArrays( gl.LINE_STRIP, 0, n - 1 );



					angle += 0.1;

					setTimeout( function() { requestAnimationFrame( draw ); } , 100 );
				};

				draw();
			};
		</script>
	</HEAD>
	
	<!--_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-->
	<!-- html just for the canvas -->

	<BODY>
		<canvas width="512" height="512"></canvas>
	</BODY>
</HTML>

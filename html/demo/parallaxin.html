<HTML>
	<HEAD>
		<TITLE>parallaxin</TITLE>

		<style>
			body {
				font-family: Comic Sans MS, sans;
				background:black;
			}
		</style>

        <script src="js/functions.js"></script>

		<script type="text/javascript">
			var DRAW_TAILS = false;

			window.onload = function() {
				const CANVAS = getByTag( 'canvas' );
				const CONTEXT = CANVAS.getContext( '2d' );

				/* hack-aroo! */
				CANVAS.setAttribute( 'width', window.innerWidth );
				CANVAS.setAttribute( 'height', window.innerHeight );

				const W = parseInt( CANVAS.width );
				const H = parseInt( CANVAS.height );

				const Z = W / 88.0;
				const ZF = 0.2;
				const ZMIN = Z * ZF;
				const ZRND = Z * ( 1 - ZF );

				const COUNT = 33 * 33;

				const STARS = [];
				for ( var i = 0 ; i < COUNT ; i++ ) {
					STARS.push( W );
					STARS.push( 0 );
					STARS.push( 0 );
				}
				const DRAW = function() {
					if ( DRAW_TAILS ) {
						CONTEXT.fillStyle = 'rgba(0,0,0,0.6)';
					} else {
						CONTEXT.fillStyle = 'rgba(0,0,0,0.8)';
					}
					CONTEXT.fillRect( 0, 0, W, H );

					for ( var i = 0 ; i < STARS.length ; i += 3 ) {
						var x = STARS[ i + 0 ];
						var y = STARS[ i + 1 ];
						var z = STARS[ i + 2 ];
						if ( x >= W ) {
							/* reset the star */
							STARS[ i + 0 ] = -( Math.random() * W );
							STARS[ i + 1 ] = Math.random() * H;
							STARS[ i + 2 ] = ZMIN + Math.random() * ZRND;
						} else {
							var scale = z / Z;
							scale *= scale;
							var gray = 127 + 64 * scale;
							var size = 2 + 2 * scale;

							/* make closer stars more yellow and further stars more blue */
							var r = 1 + 0.4 * scale;
							var g = r;
							var b = 1 + 1.4 - r;
							CONTEXT.fillStyle = 'rgb(' + gray * r + ',' + gray * g +',' + gray * b + ')';

							/* this puts a little jiggle and a wiggle */
							if ( DRAW_TAILS ) {
								var q = Math.random() * z * 0.5; 
								var ox = x;
								var oy = y;
								y += q;
								x += q;
								CONTEXT.beginPath();
									CONTEXT.moveTo( x - z * 1, y );
										CONTEXT.lineTo( x - z * 0.3, y - size * 0.2 );
											CONTEXT.lineTo( x - 0, y - size * 0.8 ); 
												CONTEXT.lineTo( x + z * 0.25, y ); /*point */
											CONTEXT.lineTo( x - 0, y + size * 0.8 );
										CONTEXT.lineTo( x - z * 0.3, y + size * 0.2 );
									/*CONTEXT.lineTo( x - z * 1, y ); implied */
								CONTEXT.closePath();
								CONTEXT.fill();

							} else {
								CONTEXT.fillRect( x, y, size, size );
							}

							/* move along the x-axis */
							STARS[ i + 0 ] += z;
						}
					}
				};

				const LOOP = frame( DRAW, 24 );
				for ( var i = 0 ; i < 33 * 4 ; i++ ) DRAW();
				LOOP.start();
			}
		</script>
	</HEAD>
	<BODY>
		<center><!-- https://www.youtube.com/watch?v=2Hf-B9Tqkss -->
			<canvas width="512" height="512"></canvas>
		</center>
	</BODY>
</HTML>
